#:kivy 2.2.0

<MainScreen>:
    orientation: 'horizontal'

    # === Left Sidebar ===
    BoxLayout:
        orientation: 'vertical'
        size_hint_x: 0.25
        padding: 12
        spacing: 16

        canvas.before:
            Color:
                rgba: 0.1, 0.1, 0.12, 1
            Rectangle:
                pos: self.pos
                size: self.size

        Label:
            text: "‚öôÔ∏è [b]Choose a Module[/b]"
            markup: True
            color: 1, 1, 1, 1
            font_size: '16sp'
            size_hint_y: None
            height: self.texture_size[1] + 10

        Button:
            text: "üîç CleanScan"
            on_press:
                app.root.ids.module_selector.text = "CleanScan"
                app.root.on_module_selected(app.root.ids.module_selector, "CleanScan")
            background_color: (0.2, 0.2, 0.25, 1)
            color: (1, 1, 1, 1)

        Button:
            text: "üîí SafeShare"
            on_press:
                app.root.ids.module_selector.text = "SafeShare"
                app.root.on_module_selected(app.root.ids.module_selector, "SafeShare")
            background_color: (0.2, 0.2, 0.25, 1)
            color: (1, 1, 1, 1)

        Button:
            text: "üß± NoiseGuard"
            on_press:
                app.root.ids.module_selector.text = "NoiseGuard"
                app.root.on_module_selected(app.root.ids.module_selector, "NoiseGuard")
            background_color: (0.2, 0.2, 0.25, 1)
            color: (1, 1, 1, 1)

        Label:
            text: "üìú [b]History Controls[/b]"
            markup: True
            color: 1, 1, 1, 1
            size_hint_y: None
            height: self.texture_size[1] + 10

        Button:
            text: "üóë Clear History"
            background_color: (0.6, 0.2, 0.2, 1)
            color: (1, 1, 1, 1)
            on_press: root.clear_history()

        Label:
            text: "‚öôÔ∏è [b]Settings[/b]"
            markup: True
            color: 1, 1, 1, 1
            size_hint_y: None
            height: self.texture_size[1] + 10

        Label:
            text: "Upload an image"
            color: 1, 1, 1, 1
            size_hint_y: None
            height: self.texture_size[1] + 5

        FileChooserListView:
            id: filechooser
            filters: ['*.png', '*.jpg', '*.jpeg']
            on_selection: root.on_file_selected(self, self.selection)
            size_hint_y: None
            height: '150dp'

    # === Main Content Area ===
    BoxLayout:
        orientation: 'vertical'
        padding: 20
        spacing: 15

        canvas.before:
            Color:
                rgba: 0.07, 0.07, 0.08, 1
            Rectangle:
                pos: self.pos
                size: self.size

        Label:
            text: "üõ°Ô∏è [b]ImageShield: Cyber Hygiene Toolkit[/b]"
            markup: True
            font_size: '24sp'
            halign: 'center'
            color: 1, 1, 1, 1
            size_hint_y: None
            height: self.texture_size[1] + 10

        Spinner:
            id: module_selector
            text: "Choose Module"
            values: ["CleanScan", "SafeShare", "NoiseGuard"]
            background_color: (0.15, 0.15, 0.18, 1)
            color: (1, 1, 1, 1)
            size_hint_y: None
            height: '40dp'
            on_text: root.on_module_selected(self, self.text)

        # === Dynamic Controls ===
        BoxLayout:
            id: dynamic_controls
            orientation: 'vertical'
            spacing: 10
            size_hint_y: None
            height: self.minimum_height

            TextInput:
                id: watermark_text
                hint_text: "Watermark Text"
                multiline: False
                size_hint_y: None
                height: '40dp'
                opacity: 0

            Slider:
                id: watermark_opacity
                min: 0
                max: 255
                value: 128
                size_hint_y: None
                height: '40dp'
                opacity: 0

            Slider:
                id: watermark_angle
                min: 0
                max: 360
                value: 45
                size_hint_y: None
                height: '40dp'
                opacity: 0

            Spinner:
                id: watermark_position
                text: "bottom-right"
                values: ["top-left", "top-right", "bottom-left", "bottom-right"]
                size_hint_y: None
                height: '40dp'
                opacity: 0

            Spinner:
                id: noise_mode
                text: "pixelate"
                values: ["pixelate", "blur", "noise"]
                size_hint_y: None
                height: '40dp'
                opacity: 0

            Slider:
                id: noise_intensity
                min: 1
                max: 50
                value: 10
                size_hint_y: None
                height: '40dp'
                opacity: 0

        Image:
            id: preview
            source: root.selected_image
            allow_stretch: True
            keep_ratio: True
            size_hint_y: None
            height: '280dp'

        BoxLayout:
            orientation: 'horizontal'
            spacing: 10
            size_hint_y: None
            height: '40dp'

            Button:
                text: "‚ñ∂ Run Module"
                background_color: (0.2, 0.5, 0.8, 1)
                color: (1, 1, 1, 1)
                on_press: root.run_selected_module()

            Button:
                text: "üì• Download"
                background_color: (0.2, 0.6, 0.3, 1)
                color: (1, 1, 1, 1)
                on_press: root.download_image()

            Button:
                text: "üìú View Log"
                background_color: (0.3, 0.3, 0.5, 1)
                color: (1, 1, 1, 1)
                on_press: root.show_audit_log()

            Button:
                text: "üíæ Export Log"
                background_color: (0.4, 0.4, 0.6, 1)
                color: (1, 1, 1, 1)
                on_press: root.export_audit_log()


        TextInput:
            id: summary
            text: "Summary will appear here..."
            readonly: True
            background_color: (0.18, 0.18, 0.2, 1)
            foreground_color: (1, 1, 1, 1)
            size_hint_y: None
            height: '120dp'